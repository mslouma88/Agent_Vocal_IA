AWSTemplateFormatVersion: '2010-09-09'
Description: Configuration pour l'application d'assistant vocal

Resources:
  ECSCluster:
    Type: AWS::ECS::Cluster
    Properties:
      ClusterName: ProjetGenerative

  ECSTaskDefinition:
    Type: AWS::ECS::TaskDefinition
    Properties:
      Family: mlops_projet
      Cpu: '256'
      Memory: '512'
      NetworkMode: awsvpc
      RequiresCompatibilities:
        - FARGATE
      ContainerDefinitions:
        - Name: mon-container
          Image: !Sub ${AWS::AccountId}.dkr.ecr.${AWS::Region}.amazonaws.com/generativeia:latest
          PortMappings:
            - ContainerPort: 8501

  ECSService:
    Type: AWS::ECS::Service
    Properties:
      ServiceName: IAservice
      Cluster: !Ref ECSCluster
      TaskDefinition: !Ref ECSTaskDefinition
      DesiredCount: 1
      LaunchType: FARGATE
      NetworkConfiguration:
        AwsvpcConfiguration:
          AssignPublicIp: ENABLED
          Subnets:
            - !Ref PublicSubnet1
            - !Ref PublicSubnet2

  # Définissez ici vos VPC, sous-réseaux, groupes de sécurité, etc.